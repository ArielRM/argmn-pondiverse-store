<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width" />
  <title>Argmin mini store</title>
  <link rel="stylesheet" href="admin.css">

  <div popover id="adminPassPopover">
    <form method="post" target="_blank"
      style="padding: 50px;display:flex;flex-direction:column;gap:10px;text-align:center;font-size: large;">
      <label for="password">Are you the admin?</label>
      <input name="password" type="password" id="password">
      <div style="display: flex;gap:10px">
        <input type="submit" value="YES!" style="font-size: xx-small;">
        <input type="button" value="No" style="flex: 1 0 80%;font-size: large;">
      </div>
    </form>
  </div>
</head>


<body>
  <nav>
    <select>
      <option value="">Filter by Type</option>
    </select>
    <select>
      <option value="">Filter by Store</option>
    </select>
    <a href="#">Pondiverse</a>
    <a href="#">source</a>
    <button id="adminButton" popovertarget="adminPassPopover">admin</button>
  </nav>

  <header>
    <h1>Argmin Store</h1>
    <p>
      Welcome to my pondiverse store/instance.
      This store, and I, have zero tolerance for abuse, hate, and other malicious behaviour.
      If you see something that doesn't belong, please use the report button on said creation or contact me via:
    <dl>
      <dt>Mastodon/fediverse</dt>
      <dd><a href="#">@ariel@hachyderm.io</a></dd>
      <dt>E-mail</dt>
      <dd><a href="mailto:argmnmail@gmail.com">argmnmail@gmail.com</a></dd>
    </dl>
    </p>
  </header>
  <main id="feed" role="feed" aria-busy="false">

    <figure>
      <h2>Title of the creation</h2>
      <div class="text">
        <pre>
soemefnkasn savioa sjd oaw  fwaf iw asd ka fwi fwi aow fwjaf afjw of wfa fawfr 
arw reaw
raw  wamrowmaoprm wamrowmaoprmawraw rojwpaj oarw 
awmr oawrm;
        </pre>
      </div>
      <figcaption>
        <dl>
          <div>
            <dt>Type</dt>
            <dd><a href="#">Real Shader II</a></dd>
          </div>
          <div>
            <dt>Store</dt>
            <dd><a href="#">todepondiverse</a></dd>
          </div>
          <div>
            <dt>Time</dt>
            <dd><a href="#">23 hours and 15 minutes ago</a></dd>
          </div>
        </dl>
      </figcaption>
      <footer>
        <ul title="Actions">
          <li><button title="show compatible tools">Open</button></li>
          <li><button title="present raw data">Raw</button></li>
          <li><button title="report this creation">Report</button></li>
          <li><button title="report this creation">Remove</button></li>
        </ul>
      </footer>
    </figure>


    <figure>
      <h2>Title of the creation</h2>
      <div class="text">
        <code>

	.pondiverse-button {
		border-radius: 100%;
		background-color: #4680ff;
		border: white 3px solid;
		height: 45px;
		width: 45px;
		cursor: pointer;
		margin: 10px;
		transition: transform 0.2s;
		color: white;
		font-size: 25px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
	}

	.pondiverse-button:hover {
		transform: scale(1.1);
	}

	#pondiverse-dialog {
		color: white;
		font-size: 20px;
		text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5);
		font-family: sans-serif;
		padding: 0px;
		background-color: transparent;
		border: none;
	}

	#pondiverse-dialog a {
		color: #46ff80;
		font-weight: bold;
	}

	#pondiverse-dialog a:focus {
		outline: 2px solid #46ff80;
	}

	#pondiverse-dialog a:hover {
		background-color: #46ff80;
		color: black;
		text-shadow: none;
		text-decoration: none;
		outline: 2px solid #46ff80;
	}
  
	.pondiverse-button {
		border-radius: 100%;
		background-color: #4680ff;
		border: white 3px solid;
		height: 45px;
		width: 45px;
		cursor: pointer;
		margin: 10px;
		transition: transform 0.2s;
		color: white;
		font-size: 25px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
	}

	.pondiverse-button:hover {
		transform: scale(1.1);
	}

	#pondiverse-dialog {
		color: white;
		font-size: 20px;
		text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5);
		font-family: sans-serif;
		padding: 0px;
		background-color: transparent;
		border: none;
	}

	#pondiverse-dialog a {
		color: #46ff80;
		font-weight: bold;
	}

	#pondiverse-dialog a:focus {
		outline: 2px solid #46ff80;
	}

	#pondiverse-dialog a:hover {
		background-color: #46ff80;
		color: black;
		text-shadow: none;
		text-decoration: none;
		outline: 2px solid #46ff80;
	}

	.pondiverse-button {
		border-radius: 100%;
		background-color: #4680ff;
		border: white 3px solid;
		height: 45px;
		width: 45px;
		cursor: pointer;
		margin: 10px;
		transition: transform 0.2s;
		color: white;
		font-size: 25px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
	}

	.pondiverse-button:hover {
		transform: scale(1.1);
	}

	#pondiverse-dialog {
		color: white;
		font-size: 20px;
		text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5);
		font-family: sans-serif;
		padding: 0px;
		background-color: transparent;
		border: none;
	}

	#pondiverse-dialog a {
		color: #46ff80;
		font-weight: bold;
	}

	#pondiverse-dialog a:focus {
		outline: 2px solid #46ff80;
	}

	#pondiverse-dialog a:hover {
		background-color: #46ff80;
		color: black;
		text-shadow: none;
		text-decoration: none;
		outline: 2px solid #46ff80;
	}

	.pondiverse-button {
		border-radius: 100%;
		background-color: #4680ff;
		border: white 3px solid;
		height: 45px;
		width: 45px;
		cursor: pointer;
		margin: 10px;
		transition: transform 0.2s;
		color: white;
		font-size: 25px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
	}

	.pondiverse-button:hover {
		transform: scale(1.1);
	}

	#pondiverse-dialog {
		color: white;
		font-size: 20px;
		text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5);
		font-family: sans-serif;
		padding: 0px;
		background-color: transparent;
		border: none;
	}

	#pondiverse-dialog a {
		color: #46ff80;
		font-weight: bold;
	}

	#pondiverse-dialog a:focus {
		outline: 2px solid #46ff80;
	}

	#pondiverse-dialog a:hover {
		background-color: #46ff80;
		color: black;
		text-shadow: none;
		text-decoration: none;
		outline: 2px solid #46ff80;
	}

        </code>
      </div>
      <figcaption>
        <dl>
          <div>
            <dt>Type</dt>
            <dd><a href="#">Real Shader II</a></dd>
          </div>
          <div>
            <dt>Store</dt>
            <dd><a href="#">todepondiverse</a></dd>
          </div>
          <div>
            <dt>Time</dt>
            <dd><a href="#">23 hours and 15 minutes ago</a></dd>
          </div>
        </dl>
      </figcaption>
      <footer>
        <ul title="Actions">
          <li><button title="show compatible tools">Open</button></li>
          <li><button title="present raw data">Raw</button></li>
          <li><button title="report this creation">Report</button></li>
          <li><button title="report this creation">Remove</button></li>
        </ul>
      </footer>
    </figure>

    <figure>
      <h2>Title of the creation</h2>
      <div>
        <img src="get-creation-image.png" alt="">
      </div>
      <figcaption>
        <dl>
          <div>
            <dt>Type</dt>
            <dd><a href="#">Real Shader II</a></dd>
          </div>
          <div>
            <dt>Store</dt>
            <dd><a href="#">todepondiverse</a></dd>
          </div>
          <div>
            <dt>Time</dt>
            <dd><a href="#">23 hours and 15 minutes ago</a></dd>
          </div>
        </dl>
      </figcaption>
      <footer>
        <ul title="Actions">
          <li><button title="show compatible tools">Open</button></li>
          <li><button title="present raw data">Raw</button></li>
          <li><button title="report this creation">Report</button></li>
          <li><button title="report this creation">Remove</button></li>
        </ul>
      </footer>
    </figure>

    <figure>
      <h2>Title of the creation</h2>
      <div>
        <img src="get-creation-image2.png" alt="">
      </div>
      <figcaption>
        <dl>
          <div>
            <dt>Type</dt>
            <dd><a href="#">Real Shader II</a></dd>
          </div>
          <div>
            <dt>Store</dt>
            <dd><a href="#">todepondiverse</a></dd>
          </div>
          <div>
            <dt>Time</dt>
            <dd><a href="#">23 hours and 15 minutes ago</a></dd>
          </div>
        </dl>
      </figcaption>
      <footer>
        <ul title="Actions">
          <li><button title="show compatible tools">Open</button></li>
          <li><button title="present raw data">Raw</button></li>
          <li><button title="report this creation">Report</button></li>
          <li><button title="report this creation">Remove</button></li>
        </ul>
      </footer>
    </figure>

  </main>
  <footer>
  </footer>
</body>

<script type="module">
  import { DEFAULT_INSTANCE } from "./pondiverse.js";
  const instance = DEFAULT_INSTANCE;

  const check_admin = async (pswd) => {
    const user = "admin";
    const password = pswd ?? sessionStorage.getItem("STORE_PSW");
    if (!password) return false;

    const res = await fetch(instance.login, {
      method: "POST",
      body: JSON.stringify({ user, password }),
    });

    if (res.status === 200) {
      sessionStorage.setItem("STORE_PSW", password);
      return true;
    }

    else {
      sessionStorage.removeItem("STORE_PSW");
      return false;
    }
  }

  const searchParams = new Proxy(window.location, {
    get: (loc, prop) => new URLSearchParams(loc.search).get(prop),
    set: (loc, prop, value) => {
      const params = new URLSearchParams(loc.search);
      params.append(prop, value);
      loc.search = params.toString();
    },
  });


  
  const is_admin = searchParams.admin === "true" && check_admin();




  const feed = document.querySelector("#feed");
  const eof = document.querySelector("#eof");
  const main = document.querySelector("main");


  const nav = document.querySelector("nav");
  const h = Math.random() * 360;
  const s = 50;
  const l = 95;
  nav.style.setProperty("--color", `hsl(${h}, ${s}%, ${l}%)`);

  const PSWD = sessionStorage.getItem("STORE_PSW");

  if (PSWD) {
    await check_admin(PSWD);
  } else {
    const adminPopover = document.querySelector("#adminPassPopover");
    const adminForm = adminPopover.querySelector("form");
    adminForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const password = e.target.querySelector("#password").value;
      const user = "admin";

    });
  }

  [...feed.children].forEach((child) => {
    const prev = child.previousElementSibling ?? main;
    const next = child.nextElementSibling ?? eof;

    const signal = Math.random() * 10 > 5 ? 1 : -1;
    const rotation = Math.random() * signal;
    child.style.setProperty("--rotation", `${rotation}deg`);

    const h = Math.random() * 360;
    const s = 50;
    const l = 95;
    child.style.setProperty("--color", `hsl(${h}, ${s}%, ${l}%)`);

    child.setAttribute("tabindex", "-1");

    child.addEventListener("keydown", (e) => {
      switch (e.key) {
        case "j":
        case "J":
          next.focus();
          break;
        case "k":
        case "K":
          prev.focus();
          break;
      }
    });
  })

</script>

</html>